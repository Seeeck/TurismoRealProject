{%load static%}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>

    <title>Reportes</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.0.272/jspdf.debug.js"></script>
</head>

<body>


    <div class="container">

        <div class="row justify-content-center">
            <div class="col-4">
                <a class="btn btn-primary" href="http://127.0.0.1:8000/admin/">Volver al panel de administracion</a>
            </div>
        </div>

        <br>
        <br>
        <br>

        <div class="row">

            <form class="col-3" action="" method="POST">
                {%csrf_token%}
                <input type="date" name="day" required>
                <button class="btn btn-primary" type="submit">Obtener reporte diario</button>
            </form>

            <form class="col-3" action="" method="POST">
                {%csrf_token%}
                <input type="week" name="week" id="camp-week" required>
                <button class="btn btn-primary" type="submit">Obtener reporte semanal</button>
            </form>

            <form class="col-3" action="" method="POST">
                {%csrf_token%}
                <input type="month" name="month" required>
                <button class="btn btn-primary" type="submit">Obtener reporte mensual</button>
            </form>


        </div>
        {%if is_reporte %}
        {%if  reporte_week%}
        <div style="background-color: white;"  id="reporteToPDF">
            
            <div class="row justify-content-center">

                <h1 class="col-6">Reporte de ventas respecto a la semana anterior</h1>
                <h1 class="col-6">Semana: {{inicio_semana}} -- {{fin_semana}}</h1>



            </div>
            <div class="row justify-content-center">
                <div class="col-6">
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center">

                            <h4>Cantidad de reservas realizadas</h4>
                            <h2><span class="badge bg-success">{{cantidad_reservas_semanal}}</span></h2>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">

                            <h4>Total semanal</h4>
                            <h2><span class="badge bg-success">${{total_semanal}}</span></h2>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <h4>Total semanal por dias de reservas</h4>
                            <h2><span class="badge bg-success">{{total_reserva_dias_departamento}}</span></h2>
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total %}
                            <h4>Aumento de ventas totales</h4>
                            <h2><span class="badge bg-success">{{aumento_total}}</span></h2>
                            {%else%}
                            <h4>Disminución de ventas totales</h4>
                            <h2><span class="badge bg-danger">{{aumento_total}}</span></h2>
                            {%endif%}
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total_porcentaje %}
                            <h4>Porcentaje de aumento de ventas totales</h4>
                            <h2><span class="badge bg-success">+{{porcentaje_aumento_total}}</span></h2>
                            {%else%}
                            <h4>Porcentaje de disminución de ventas totales</h4>
                            <h2><span class="badge bg-danger">{{porcentaje_aumento_total}}</span></h2>
                            {%endif%}
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <h4>Total de tours</h4>
                            <h2><span class="badge bg-success">{{total_tour_semanal}}</span></h2>
                        </li>


                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total_tour %}
                            <h4>Aumento del ventas totales de tour</h4>
                            <h2><span class="badge bg-success">{{aumento_tour}}</span></h2>
                            {%else%}
                            <h4>Disminucion de ventas totales de tour</h4>
                            <h2><span class="badge bg-danger">{{aumento_tour}}</span></h2>
                            {%endif%}
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <h4>Total de transportes</h4>
                            <h2><span class="badge bg-success">{{total_transporte_semanal}}</span></h2>
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total_transporte %}
                            <h4>Aumento del ventas totales de transporte</h4>
                            <h2><span class="badge bg-success">{{aumento_transporte}}</span></h2>
                            {%else%}
                            <h4>Disminucion de ventas totales de transporte</h4>
                            <h2><span class="badge bg-danger">{{aumento_transporte}}</span></h2>
                            {%endif%}
                        </li>
                    </ul>
                </div>
                <div class="row justify-content-center">
                    <div class="col-6">
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center">

                                <h4>Cantidad de reservas realizadas</h4>
                                <h2><span class="badge bg-success">{{cantidad_reservas_semanal}}</span></h2>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">

                                <h4>Total semanal</h4>
                                <h2><span class="badge bg-success">${{total_semanal}}</span></h2>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <h4>Total semanal por dias de reservas</h4>
                                <h2><span class="badge bg-success">{{total_reserva_dias_departamento}}</span></h2>
                            </li>

                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                {%if is_aumento_total %}
                                <h4>Aumento de ventas totales</h4>
                                <h2><span class="badge bg-success">{{aumento_total}}</span></h2>
                                {%else%}
                                <h4>Disminución de ventas totales</h4>
                                <h2><span class="badge bg-danger">{{aumento_total}}</span></h2>
                                {%endif%}
                            </li>

                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                {%if is_aumento_total_porcentaje %}
                                <h4>Porcentaje de aumento de ventas totales</h4>
                                <h2><span class="badge bg-success">+{{porcentaje_aumento_total}}</span></h2>
                                {%else%}
                                <h4>Porcentaje de disminución de ventas totales</h4>
                                <h2><span class="badge bg-danger">{{porcentaje_aumento_total}}</span></h2>
                                {%endif%}
                            </li>

                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <h4>Total de tours</h4>
                                <h2><span class="badge bg-success">{{total_tour_semanal}}</span></h2>
                            </li>


                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                {%if is_aumento_total_tour %}
                                <h4>Aumento del ventas totales de tour</h4>
                                <h2><span class="badge bg-success">{{aumento_tour}}</span></h2>
                                {%else%}
                                <h4>Disminucion de ventas totales de tour</h4>
                                <h2><span class="badge bg-danger">{{aumento_tour}}</span></h2>
                                {%endif%}
                            </li>

                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <h4>Total de transportes</h4>
                                <h2><span class="badge bg-success">{{total_transporte_semanal}}</span></h2>
                            </li>

                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                {%if is_aumento_total_transporte %}
                                <h4>Aumento del ventas totales de transporte</h4>
                                <h2><span class="badge bg-success">{{aumento_transporte}}</span></h2>
                                {%else%}
                                <h4>Disminucion de ventas totales de transporte</h4>
                                <h2><span class="badge bg-danger">{{aumento_transporte}}</span></h2>
                                {%endif%}
                            </li>
                        </ul>
                    </div>

                </div>
            </div>
            <br>
            <br>
            <div id="editor"></div>
            <div class=" mb-4 row justify-content-center">
                <div class="col-2">
                    <button id="generatePDF" class="btn btn-success">Importar a PDF</button>
                </div>
            </div>
            
        </div>
        {%endif%}
        {%if reporte_day%}
        <div style="background-color: white;"  id="reporteToPDF">
            
            
            <div class="row justify-content-center">

                <h1 class="col-6">Reporte de ventas respecto al dia anterior</h1>
                <h1 class="col-6">Dia: {{dia}}</h1>


            <script type="text/javascript">
                var doc = new jsPDF();
                var specialElementHandlers = {
                    '#editor': function (element, renderer) {
                        return true;
                    }
                };


                $('#generatePDF').click(function () {
                    doc.fromHTML($('#importarPDFweek').html(), 15, 15, {
                        'width': 700,
                        'elementHandlers': specialElementHandlers
                    });
                    doc.save('ejemplo.pdf');
                });

            </script>
            
        </div>
        {%endif%}

            </div>
            <div class="row justify-content-center">
                <div class="col-6">
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center">

                            <h4>Cantidad de reservas realizadas</h4>
                            <h2><span class="badge bg-success">{{cantidad_reservas_dia}}</span></h2>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">

                            <h4>Total por dia</h4>
                            <h2><span class="badge bg-success">${{total_dia}}</span></h2>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <h4>Total final por dias de reservas</h4>
                            <h2><span class="badge bg-success">{{total_reserva_dias_departamento}}</span></h2>
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total %}
                            <h4>Aumento de ventas totales</h4>
                            <h2><span class="badge bg-success">{{aumento_total}}</span></h2>
                            {%else%}
                            <h4>Disminución de ventas totales</h4>
                            <h2><span class="badge bg-danger">{{aumento_total}}</span></h2>
                            {%endif%}
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total_porcentaje %}
                            <h4>Porcentaje de aumento de ventas totales</h4>
                            <h2><span class="badge bg-success">+{{porcentaje_aumento_total}}</span></h2>
                            {%else%}
                            <h4>Porcentaje de disminución de ventas totales</h4>
                            <h2><span class="badge bg-danger">{{porcentaje_aumento_total}}</span></h2>
                            {%endif%}
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <h4>Total de tours</h4>
                            <h2><span class="badge bg-success">{{total_tour_dia}}</span></h2>
                        </li>


                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total_tour %}
                            <h4>Aumento del ventas totales de tour</h4>
                            <h2><span class="badge bg-success">{{aumento_tour}}</span></h2>
                            {%else%}
                            <h4>Disminucion de ventas totales de tour</h4>
                            <h2><span class="badge bg-danger">{{aumento_tour}}</span></h2>
                            {%endif%}
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <h4>Total de transportes</h4>
                            <h2><span class="badge bg-success">{{total_transporte_dia}}</span></h2>
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total_transporte %}
                            <h4>Aumento del ventas totales de transporte</h4>
                            <h2><span class="badge bg-success">{{aumento_transporte}}</span></h2>
                            {%else%}
                            <h4>Disminucion de ventas totales de transporte</h4>
                            <h2><span class="badge bg-danger">{{aumento_transporte}}</span></h2>
                            {%endif%}
                        </li>
                    </ul>
                </div>

            </div>
           
        </div>
        {%endif%}
        {%if reporte_month%}
        <div style="background-color: white;" id="reporteToPDF">
            
            <div class="row justify-content-center">

                <h1 class="col-6">Reporte de ventas respecto al mes anterior</h1>
                <h1 class="col-6">mes: {{mes_anio}}</h1>



            </div>
            <div class="row justify-content-center">
                <div class="col-6">
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center">

                            <h4>Cantidad de reservas realizadas</h4>
                            <h2><span class="badge bg-success">{{cantidad_reservas_mes}}</span></h2>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">

                            <h4>Total por mes</h4>
                            <h2><span class="badge bg-success">${{total_mes}}</span></h2>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <h4>Total final por dias de reservas</h4>
                            <h2><span class="badge bg-success">{{total_reserva_dias_departamento}}</span></h2>
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total %}
                            <h4>Aumento de ventas totales</h4>
                            <h2><span class="badge bg-success">{{aumento_total}}</span></h2>
                            {%else%}
                            <h4>Disminución de ventas totales</h4>
                            <h2><span class="badge bg-danger">{{aumento_total}}</span></h2>
                            {%endif%}
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total_porcentaje %}
                            <h4>Porcentaje de aumento de ventas totales</h4>
                            <h2><span class="badge bg-success">+{{porcentaje_aumento_total}}</span></h2>
                            {%else%}
                            <h4>Porcentaje de disminución de ventas totales</h4>
                            <h2><span class="badge bg-danger">{{porcentaje_aumento_total}}</span></h2>
                            {%endif%}
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <h4>Total de tours</h4>
                            <h2><span class="badge bg-success">{{total_tour_mes}}</span></h2>
                        </li>


                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total_tour %}
                            <h4>Aumento del ventas totales de tour</h4>
                            <h2><span class="badge bg-success">{{aumento_tour}}</span></h2>
                            {%else%}
                            <h4>Disminucion de ventas totales de tour</h4>
                            <h2><span class="badge bg-danger">{{aumento_tour}}</span></h2>
                            {%endif%}
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <h4>Total de transportes</h4>
                            <h2><span class="badge bg-success">{{total_transporte_mes}}</span></h2>
                        </li>

                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {%if is_aumento_total_transporte %}
                            <h4>Aumento del ventas totales de transporte</h4>
                            <h2><span class="badge bg-success">{{aumento_transporte}}</span></h2>
                            {%else%}
                            <h4>Disminucion de ventas totales de transporte</h4>
                            <h2><span class="badge bg-danger">{{aumento_transporte}}</span></h2>
                            {%endif%}
                        </li>
                    </ul>
                </div>

            </div>
      
        </div>

        {%endif%}
        <br>
        <br>
        <div class="row mb-4 justify-content-center">
            <div class="col-2"><button class="btn btn-success" id="toPDFButton">Importar a PDF</button></div>
        </div>
        
       
        

        {%if sin_reservas%}
        {{mensaje}}
        {%endif%}
    </div>
    <script>
        $(document).on('click', '#toPDFButton', function () {
            let pdf = new jsPDF();
            let section = $('#reporteToPDF');
            let page = function () {
                if('{{reporte_month}}'=='True'){
                    pdf.save('{{mes_anio}}.pdf');
                }
                if('{{reporte_day}}'=='True'){
                    pdf.save('{{dia}}.pdf');
                }
                if('{{reporte_week}}'=='True'){
                    pdf.save('{{inicio_semana}}[-]{{fin_semana}}.pdf');
                }
            };
            pdf.addHTML(section, page);
        })
    </script>
</body>

</html>